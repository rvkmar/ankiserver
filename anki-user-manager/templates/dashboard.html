{% extends "base.html" %}
{% block content %}
<h2>ðŸ“Š Student Dashboard</h2>

<div class="card mx-auto" style="max-width:900px;">
  <div class="card-body">
    <table class="table table-striped table-bordered">
      <thead class="table-dark">
        <tr>
          <th>Student Name</th>
          <th>Total Cards</th>
          <th>Due Cards</th>
          <th>Reviews Today</th>
          <th>Details</th>
        </tr>
      </thead>
      <tbody id="stats-body">
        <tr>
          <td colspan="5" class="text-center">Loading...</td>
        </tr>
      </tbody>
      <tbody>
        {% for s in stats_list %}
        <tr>
          <td>{{ s.username }}</td>
          <td>{{ s.total_cards }}</td>
          <td>{{ s.due_cards }}</td>
          <td>{{ s.reviews_today }}</td>
          <td>
            <a class="btn btn-sm btn-info" href="{{ url_for('student_dashboard', username=s.username) }}">View</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<script>
  async function loadDashboardStats() {
    const res = await fetch("{{ url_for('api_dashboard_stats') }}");
    const data = await res.json();
    const tbody = document.getElementById("stats-body");
    tbody.innerHTML = "";

    data.stats.forEach(s => {
      tbody.innerHTML += `
        <tr>
          <td>${s.username}</td>
          <td>${s.total_cards}</td>
          <td>${s.due_cards}</td>
          <td>${s.reviews_today}</td>
          <td><a class="btn btn-sm btn-info" href="/dashboard/${s.username}">View</a></td>
        </tr>
      `;
    });
  }

  document.addEventListener("DOMContentLoaded", loadDashboardStats);
</script>

{% endblock %}