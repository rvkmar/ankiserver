{% extends "base.html" %}
{% block content %}
<h2>ðŸ“Š Dashboard for {{ stats.username }}</h2>

<div class="card mx-auto mb-4" style="max-width:700px;">
  <div class="card-body">
    <h4>Summary</h4>
    <ul>
      <li><b>Total Cards:</b> {{ stats.total_cards }}</li>
      <li><b>Due Cards:</b> {{ stats.due_cards }}</li>
      <li><b>Reviews Today:</b> {{ stats.reviews_today }}</li>
    </ul>
  </div>
</div>

<div class="card mx-auto mb-4" style="max-width:900px;">
  <div class="card-body">
    <h4>Deck Breakdown</h4>
    <table class="table table-bordered">
      <thead class="table-dark">
        <tr><th>Deck</th><th>Total</th><th>Due</th><th>Reviews Today</th></tr>
      </thead>
      <tbody>
        {% for d in deck_stats %}
        <tr>
          <td>{{ d.deck }}</td>
          <td>{{ d.total }}</td>
          <td>{{ d.due }}</td>
          <td>{{ d.reviews_today }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <canvas id="deckChart" height="150"></canvas>
  </div>
</div>

<div class="card mx-auto" style="max-width:900px;">
  <div class="card-body">
    <h4>ðŸ“ˆ Review History (last 30 days)</h4>
    <canvas id="reviewHistory" height="150"></canvas>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Pie chart of total cards per deck
const deckCtx = document.getElementById('deckChart').getContext('2d');
new Chart(deckCtx, {
  type: 'pie',
  data: {
    labels: [{% for d in deck_stats %}"{{ d.name }}",{% endfor %}],
    datasets: [{
      data: [{% for d in deck_stats %}{{ d.total }},{% endfor %}],
      backgroundColor: [
        'rgba(255, 99, 132, 0.6)',
        'rgba(54, 162, 235, 0.6)',
        'rgba(255, 206, 86, 0.6)',
        'rgba(75, 192, 192, 0.6)',
        'rgba(153, 102, 255, 0.6)',
        'rgba(255, 159, 64, 0.6)'
      ]
    }]
  },
  options: {
    plugins: { title: { display: true, text: 'Cards per Deck' } }
  }
});

// Review history line chart
const ctx = document.getElementById('reviewHistory').getContext('2d');
const historyLabels = [{% for r in history %}"{{ r.day }}",{% endfor %}];
const historyCounts = [{% for r in history %}{{ r.count }},{% endfor %}];

new Chart(ctx, {
  type: 'line',
  data: {
    labels: historyLabels,
    datasets: [{
      label: 'Reviews per Day',
      data: historyCounts,
      borderColor: 'rgb(75, 192, 192)',
      tension: 0.2,
      fill: false
    }]
  }
});
</script>
{% endblock %}

