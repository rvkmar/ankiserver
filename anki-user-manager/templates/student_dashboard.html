{% extends "base.html" %}
{% block content %}
<h2>üìä Stats for {{ student }}</h2>

<div class="row">
  <!-- Card Types -->
  <div class="col-md-6">
    <div class="card mb-4">
      <div class="card-body">
        <h5>Card Types</h5>
        <canvas id="cardTypeChart" height="200"></canvas>
      </div>
    </div>
  </div>

  <!-- Answer Buttons -->
  <div class="col-md-6">
    <div class="card mb-4">
      <div class="card-body">
        <h5>Answer Buttons</h5>
        <canvas id="easeChart" height="200"></canvas>
      </div>
    </div>
  </div>
</div>

<!-- Reviews per Day -->
<div class="card mb-4">
  <div class="card-body">
    <h5>Reviews per Day (last 30 days)</h5>
    <canvas id="reviewChart" height="120"></canvas>
  </div>
</div>

<!-- Backlog (Future Due) -->
<div class="card mb-4">
  <div class="card-body">
    <h5>üìÖ Backlog (Future Due Cards, next 30 days)</h5>
    <canvas id="backlogChart" height="120"></canvas>
  </div>
</div>

<!-- Intervals Histogram -->
<div class="card mb-4">
  <div class="card-body">
    <h5>‚è≥ Intervals Histogram</h5>
    <canvas id="intervalsChart" height="120"></canvas>
  </div>
</div>

<script>
  // --- Intervals Histogram ---
  const intervalsCtx = document.getElementById('intervalsChart').getContext('2d');
  new Chart(intervalsCtx, {
    type: 'bar',
    data: {
      labels: [{% for lbl, cnt in full_stats.intervals %}"{{ lbl }}",{% endfor %}],
    datasets: [{
      label: "Cards",
      data: [{% for lbl, cnt in full_stats.intervals %}{{ cnt }}, {% endfor %}],
    backgroundColor: "rgba(153, 102, 255, 0.6)"
    }]
  },
    options: {
    responsive: true,
    plugins: {
      title: { display: true, text: "Card Distribution by Interval" }
    },
    scales: {
      y: { beginAtZero: true }
    }
  }
});
</script>

<script>
  // --- Backlog (Future Due) ---
  const backlogCtx = document.getElementById('backlogChart').getContext('2d');
  new Chart(backlogCtx, {
    type: 'bar',
    data: {
      labels: [{% for d, c in full_stats.future_due %}"{{ d }}",{% endfor %}],
    datasets: [{
      label: "Due Cards",
      data: [{% for d, c in full_stats.future_due %}{{ c }}, {% endfor %}],
    backgroundColor: "rgba(75, 192, 192, 0.6)"
    }]
  },
    options: {
    responsive: true,
    scales: { y: { beginAtZero: true } },
    plugins: {
      title: { display: true, text: "Future Scheduled Cards" }
    }
  }
});
</script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // --- Card Types Pie Chart ---
  const cardTypeCtx = document.getElementById('cardTypeChart').getContext('2d');
  new Chart(cardTypeCtx, {
    type: 'pie',
    data: {
      labels: ["New", "Learning", "Review", "Relearning"],
      datasets: [{
        data: [
          {{ full_stats.card_types.get(0, 0) }},
      {{ full_stats.card_types.get(1, 0) }},
        {{ full_stats.card_types.get(2, 0) }},
    {{ full_stats.card_types.get(3, 0) }}
      ],
    backgroundColor: ['#ff6384', '#36a2eb', '#ffce56', '#4bc0c0']
    }]
  },
    options: { responsive: true }
});

  // --- Answer Buttons Pie Chart ---
  const easeCtx = document.getElementById('easeChart').getContext('2d');
  new Chart(easeCtx, {
    type: 'pie',
    data: {
      labels: ["Again", "Hard", "Good", "Easy"],
      datasets: [{
        data: [
          {{ full_stats.ease_counts.get(1, 0) }},
      {{ full_stats.ease_counts.get(2, 0) }},
        {{ full_stats.ease_counts.get(3, 0) }},
    {{ full_stats.ease_counts.get(4, 0) }}
      ],
    backgroundColor: ['#ff6384', '#ff9f40', '#36a2eb', '#4bc0c0']
    }]
  },
    options: { responsive: true }
});

  // --- Reviews per Day (last 30 days) ---
  const reviewCtx = document.getElementById('reviewChart').getContext('2d');
  new Chart(reviewCtx, {
    type: 'line',
    data: {
      labels: [{% for d, c in full_stats.reviews_per_day %}"{{ d }}",{% endfor %}],
    datasets: [{
      label: "Reviews",
      data: [{% for d, c in full_stats.reviews_per_day %}{{ c }}, {% endfor %}],
    borderColor: "#36a2eb",
    fill: true,
    tension: 0.2
    }]
  },
    options: {
    responsive: true,
    scales: { y: { beginAtZero: true } }
  }
});
</script>
{% endblock %}